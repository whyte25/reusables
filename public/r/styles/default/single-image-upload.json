{
  "name": "single-image-upload",
  "type": "registry:component",
  "dependencies": [
    "lucide-react",
    "react-dropzone",
    "class-variance-authority"
  ],
  "registryDependencies": [
    "utils"
  ],
  "files": [
    {
      "path": "reusables/single-image-upload.tsx",
      "content": "\"use client\";\n\nimport { cn } from \"@/lib/utils\";\nimport { cva } from \"class-variance-authority\";\nimport { UploadCloud, X } from \"lucide-react\";\nimport * as React from \"react\";\nimport { useDropzone, type DropzoneOptions } from \"react-dropzone\";\n\nexport const formatFileSize = (bytes: number) => {\n  if (typeof bytes !== \"number\") return \"0 B\";\n  if (bytes === 0) return \"0 B\";\n  const units = [\"B\", \"KB\", \"MB\", \"GB\"] as const;\n  const exponent = Math.min(\n    Math.floor(Math.log(bytes) / Math.log(1024)),\n    units.length - 1\n  );\n  const size = Number((bytes / Math.pow(1024, exponent)).toFixed(2));\n  return `${size} ${units[exponent]}`;\n};\n\nconst dropzoneVariants = cva(\n  \"relative flex justify-center items-center flex-col cursor-pointer transition-all duration-300 ease-in-out border-2 border-dashed rounded-lg\",\n  {\n    variants: {\n      variant: {\n        base: \"border-gray-300 dark:border-gray-600 bg-white dark:bg-transparent dark:hover:bg-gray-800 hover:border-gray-400 dark:hover:border-gray-500\",\n        image: \"border-transparent bg-transparent\",\n        active: \"border-gray-400 dark:border-gray-500\",\n        disabled:\n          \"bg-gray-100 dark:bg-gray-700 border-gray-300 dark:border-gray-600 cursor-not-allowed\",\n        accept:\n          \"border-green-500 dark:border-green-400 bg-green-50 dark:bg-green-900/20\",\n        reject:\n          \"border-red-500 dark:border-red-400 bg-red-50 dark:bg-red-900/20\",\n      },\n    },\n    defaultVariants: {\n      variant: \"base\",\n    },\n  }\n);\n\ntype ProgressType = \"linear\" | \"circular\";\n\ntype InputProps = {\n  width?: string;\n  height?: string;\n  className?: string;\n  value?: File | string;\n  onChange?: (file?: File) => void | Promise<void>;\n  disabled?: boolean;\n  dropzoneOptions?: Omit<DropzoneOptions, \"disabled\">;\n  directUpload?: boolean;\n  progress?: number;\n  progressType?: ProgressType;\n};\n\nconst ERROR_MESSAGES = {\n  fileTooLarge: (maxSize: number) =>\n    `File too large. Max size: ${formatFileSize(maxSize)}.`,\n  fileInvalidType: () => \"Invalid file type.\",\n  tooManyFiles: (maxFiles: number) => `Max ${maxFiles} file(s) allowed.`,\n  fileNotSupported: () => \"File type not supported.\",\n};\n\nexport const SingleImageDropzone = React.forwardRef<\n  HTMLInputElement,\n  InputProps\n>(\n  (\n    {\n      dropzoneOptions,\n      width = \"100%\",\n      height = \"240px\",\n      value,\n      className,\n      disabled,\n      onChange,\n      directUpload = true,\n      progress,\n      progressType = \"linear\",\n    },\n    ref\n  ) => {\n    const [localValue, setLocalValue] = React.useState<File | undefined>(\n      undefined\n    );\n\n    // Sync localValue with form value\n    React.useEffect(() => {\n      if (!value) {\n        setLocalValue(undefined);\n      }\n    }, [value]);\n\n    const imageUrl = React.useMemo(() => {\n      const fileToUse = directUpload ? localValue : value;\n      if (typeof fileToUse === \"string\") return fileToUse;\n      if (fileToUse instanceof File) return URL.createObjectURL(fileToUse);\n      return null;\n    }, [value, localValue, directUpload]);\n\n    const onDrop = React.useCallback(\n      (acceptedFiles: File[]) => {\n        const file = acceptedFiles[0];\n        if (!file) return;\n\n        setLocalValue(file);\n        void onChange?.(file);\n      },\n      [onChange]\n    );\n\n    const {\n      getRootProps,\n      getInputProps,\n      acceptedFiles,\n      fileRejections,\n      isFocused,\n      isDragAccept,\n      isDragReject,\n    } = useDropzone({\n      accept: { \"image/*\": [] },\n      multiple: false,\n      disabled,\n      onDrop,\n      ...dropzoneOptions,\n    });\n\n    const variant = React.useMemo(() => {\n      if (imageUrl) return \"image\";\n      if (disabled) return \"disabled\";\n      if (isDragReject || fileRejections.length) return \"reject\";\n      if (isDragAccept) return \"accept\";\n      if (isFocused) return \"active\";\n      return \"base\";\n    }, [\n      isFocused,\n      imageUrl,\n      fileRejections,\n      isDragAccept,\n      isDragReject,\n      disabled,\n    ]);\n\n    const errorMessage = React.useMemo(() => {\n      if (fileRejections[0]) {\n        const { errors } = fileRejections[0];\n        if (errors[0]?.code === \"file-too-large\") {\n          return ERROR_MESSAGES.fileTooLarge(dropzoneOptions?.maxSize ?? 0);\n        } else if (errors[0]?.code === \"file-invalid-type\") {\n          return ERROR_MESSAGES.fileInvalidType();\n        } else if (errors[0]?.code === \"too-many-files\") {\n          return ERROR_MESSAGES.tooManyFiles(dropzoneOptions?.maxFiles ?? 0);\n        } else {\n          return ERROR_MESSAGES.fileNotSupported();\n        }\n      }\n      return undefined;\n    }, [fileRejections, dropzoneOptions]);\n\n    const handleClear = (e: React.MouseEvent) => {\n      e.stopPropagation();\n      setLocalValue(undefined);\n      void onChange?.(undefined);\n    };\n\n    return (\n      <div className=\"w-full\">\n        <div\n          {...getRootProps({\n            className: cn(dropzoneVariants({ variant }), className),\n            style: { width, height },\n          })}\n        >\n          <input ref={ref} {...getInputProps()} />\n\n          {imageUrl ? (\n            <div className=\"group relative h-full w-full overflow-hidden rounded-lg\">\n              <img\n                className=\"h-full w-full my-0 object-cover transition-transform duration-300 group-hover:scale-105\"\n                src={imageUrl}\n                alt={acceptedFiles[0]?.name}\n              />\n\n              <div\n                className={cn(\n                  \"absolute inset-0 flex items-center justify-center bg-black \",\n                  progress\n                    ? \"bg-opacity-90\"\n                    : \"bg-opacity-20 group-hover:bg-opacity-90\"\n                )}\n              >\n                {progress ? (\n                  <>\n                    {progressType === \"linear\" && (\n                      <span className=\"text-lg animate-pulse font-medium text-white transition-opacity duration-[3000ms]\">\n                        Uploading...\n                      </span>\n                    )}\n                    <ProgressIndicator\n                      progress={progress}\n                      type={progressType}\n                    />\n                  </>\n                ) : (\n                  <span className=\"text-lg font-medium text-white opacity-0 transition-opacity duration-300 group-hover:opacity-100\">\n                    Replace image\n                  </span>\n                )}\n              </div>\n            </div>\n          ) : (\n            <div className=\"flex flex-col items-center justify-center space-y-4 text-center\">\n              <div className=\"rounded-full bg-gray-100 dark:bg-gray-700 p-3\">\n                <UploadCloud className=\"h-8 w-8 text-gray-600 dark:text-gray-400\" />\n              </div>\n              <div className=\"text-sm font-medium text-gray-700 dark:text-gray-300\">\n                Drag & drop your image here\n              </div>\n              <div className=\"text-xs text-gray-500 dark:text-gray-400\">or</div>\n              <button\n                type=\"button\"\n                disabled={disabled}\n                className=\"rounded-full bg-gray-800 dark:bg-gray-200 px-6 py-2 text-sm font-medium text-white dark:text-gray-800 transition-colors hover:bg-gray-700 dark:hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 disabled:bg-gray-400 dark:disabled:bg-gray-600\"\n              >\n                Browse files\n              </button>\n            </div>\n          )}\n\n          {imageUrl && !disabled && (\n            <button\n              type=\"button\"\n              onClick={handleClear}\n              className=\"absolute right-2 top-2 rounded-full bg-white dark:bg-gray-800 p-1 text-gray-500 dark:text-gray-400 transition-colors hover:bg-gray-100 dark:hover:bg-gray-700 hover:text-gray-700 dark:hover:text-gray-200 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2\"\n            >\n              <X className=\"h-5 w-5\" />\n            </button>\n          )}\n        </div>\n\n        {errorMessage && (\n          <div className=\"mt-2 text-sm text-red-600 dark:text-red-400\">\n            {errorMessage}\n          </div>\n        )}\n      </div>\n    );\n  }\n);\n\nSingleImageDropzone.displayName = \"SingleImageDropzone\";\n\nconst ProgressIndicator = ({\n  progress = 0,\n  type = \"linear\",\n}: {\n  progress: number;\n  type?: ProgressType;\n}) => {\n  if (type === \"circular\") {\n    return (\n      <div className=\"relative h-16 w-16\">\n        <svg className=\"h-full w-full\" viewBox=\"0 0 100 100\">\n          <circle\n            className=\"stroke-gray-300 dark:stroke-gray-600\"\n            fill=\"none\"\n            cx=\"50\"\n            cy=\"50\"\n            r=\"45\"\n            strokeWidth=\"8\"\n          />\n          <circle\n            className=\"stroke-green-600 transition-all duration-300 ease-out\"\n            fill=\"none\"\n            cx=\"50\"\n            cy=\"50\"\n            r=\"45\"\n            strokeWidth=\"8\"\n            strokeLinecap=\"round\"\n            strokeDasharray={`${progress * 2.82743}, 282.743`}\n            transform=\"rotate(-90 50 50)\"\n          />\n        </svg>\n        <div className=\"absolute inset-0 flex items-center justify-center\">\n          <span className=\"text-sm font-medium text-white\">\n            {Math.round(progress)}%\n          </span>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"absolute bottom-0 left-0 h-1 w-full bg-gray-200 dark:bg-gray-700\">\n      <div\n        className=\"h-full bg-green-600 transition-all duration-300 ease-out\"\n        style={{ width: `${progress}%` }}\n      />\n    </div>\n  );\n};\n",
      "type": "registry:component"
    },
    {
      "path": "hooks/use-file-upload.tsx",
      "content": "\"use client\";\r\nimport axios from \"axios\";\r\nimport { useRef, useState } from \"react\";\r\n\r\ninterface UseFileUploadParams {\r\n  onSuccess?: (url: string) => void;\r\n  onError?: (error: string) => void;\r\n}\r\n\r\nconst useFileUpload = ({ onSuccess, onError }: UseFileUploadParams = {}) => {\r\n  const [selectedFile, setSelectedFile] = useState<File | null>(null);\r\n  const [isUploading, setIsUploading] = useState(false);\r\n  const [progress, setProgress] = useState(0);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const abortControllerRef = useRef<AbortController | null>(null);\r\n  const [data, setData] = useState(null);\r\n\r\n  const handleFileUpload = async (file: File | null) => {\r\n    if (!file) {\r\n      throw new Error(\"No file selected\");\r\n    }\r\n\r\n    setSelectedFile(file);\r\n    setIsUploading(true);\r\n    setError(null);\r\n\r\n    abortControllerRef.current = new AbortController();\r\n\r\n    try {\r\n      const formData = new FormData();\r\n      formData.append(\"file\", file);\r\n\r\n      // TODO: Replace with your own API endpoint\r\n      const response = await axios.post(\r\n        `https://your-api-endpoint.com`,\r\n        formData,\r\n        {\r\n          signal: abortControllerRef.current.signal,\r\n          onUploadProgress: (progressEvent) => {\r\n            const percentCompleted = Math.round(\r\n              (progressEvent.loaded * 100) / progressEvent.total!\r\n            );\r\n            setProgress(percentCompleted);\r\n          },\r\n        }\r\n      );\r\n      // TODO: Replace with your own API response\r\n      const uploadedUrl = response?.data?.secure_url;\r\n\r\n      setData(uploadedUrl);\r\n      onSuccess?.(uploadedUrl);\r\n      setIsUploading(false);\r\n      setProgress(0);\r\n      abortControllerRef.current = null;\r\n    } catch (error: any) {\r\n      if (axios.isCancel(error)) {\r\n        const cancelMessage = \"Upload cancelled\";\r\n        console.log(cancelMessage);\r\n      } else {\r\n        const errorMessage = error.response?.data?.message || \"Upload failed\";\r\n        setError(errorMessage);\r\n        onError?.(errorMessage);\r\n      }\r\n      setIsUploading(false);\r\n      setSelectedFile(null);\r\n      setProgress(0);\r\n      setData(null);\r\n      abortControllerRef.current = null;\r\n    }\r\n  };\r\n\r\n  const cancelUpload = () => {\r\n    if (abortControllerRef.current) {\r\n      abortControllerRef.current.abort();\r\n    }\r\n    setSelectedFile(null);\r\n    setIsUploading(false);\r\n    setProgress(0);\r\n    setError(null);\r\n    setData(null);\r\n  };\r\n\r\n  return {\r\n    selectedFile,\r\n    isUploading,\r\n    progress,\r\n    error,\r\n    handleFileUpload,\r\n    cancelUpload,\r\n    data,\r\n  };\r\n};\r\n\r\nexport default useFileUpload;\r\n",
      "type": "registry:hook"
    }
  ]
}